<project name="JTablet2" default="jars" basedir=".">
    <description>
        JTablet2
    </description>
	
  <!-- set global properties for this build -->
			 
	  <property name="src"					location="src"/>
	  <property name="src.demo"				location="src-demo"/>
	  <property name="src.installer"		location="src-installer"/>
	  <property name="src.jpen"				location="../jpen/src/main/java"/>
	  <property name="src.jpen.resources"	location="../jpen/src/main/resources"/>
		

	  <property name="build.version.file"	location="build/svn.version"/>
	
	  <property name="build.jtablet"		location="build/jtablet"/>
	  <property name="build.jpen"			location="build/jpen"/>
	  <property name="build.demo"			location="build/demo"/>
	  <property name="build.installer"		location="build/installer"/>
	
	  <property name="docs.api"				location="docs/api"/>
		
	  <property name="dist"  				location="dist"/>
	  <property name="lib.dir"     			location="lib"/>

	  <property name="ext.name"				value="JTablet"/>
	
	  <property name="spec.title"			value="JTablet 2"/>
	  <property name="spec.vendor"			value="Cellosoft"/>
	  <property name="spec.version"			value="1.2.0"/>
	
	  <property name="impl.title"			value="JTablet 2"/>
	  <property name="impl.vendor"			value="Cellosoft"/>
	  <property name="impl.vendor.id"		value="cello"/>
	  <property name="impl.version"			value="1.2.0-alpha"/>
	
	<condition property="platform" value="mac">
		<os family="mac"/>
	</condition>
	<condition property="platform" value="windows">
		<os family="windows"/>
	</condition>
	<condition property="platform" value="unix">
	    <and>
	      <os family="unix"/>
	      <not>
	        <os family="mac"/>
	      </not>
	    </and>
	</condition>
	
	

  <target name="init" depends="svn.version">
    <!-- Create the time stamp -->
    <tstamp/>
  </target>
	
	<target name="svn.version" description="Sets the buildversion for the current build">
		<!--<exec executable="svnversion" spawn="false" dir="." outputproperty="svn.version"></exec>-->
		<property name="svn.version" value="dev"/>
	</target>


  <!-- BUILD JPEN -->
  <target name="jpen.compile" depends="init" description="compile the source" >
    <mkdir dir="${build.jpen}"/>
    <javac 
		srcdir="${src.jpen}"          
		includes="**"
		destdir="${build.jpen}" 
		source="1.5" 
		target="1.5"
		debug="on"/>
  	<copy todir="${build.jpen}" filtering="true">
		<fileset dir="${src.jpen.resources}">
		  <include name="**/*"/>
		</fileset>
	</copy>
  </target>
  <target name="jpen.jar" depends="jpen.compile">
	<jar 
		jarfile="${dist}/lib/jpen2-${svn.version}.original.jar"
		includes="jpen/**"
    	excludes="jpen/demo/**"
		level="9"
		basedir="${build.jpen}">
	</jar>
  </target>


  <!-- MAIN JTABLET JAR -->
	
  <path id="jtablet.classpath">
		<pathelement location="${build.jpen}"/>
  </path>
	
  <target name="jtablet.compile" depends="init,jpen.compile" description="compile the source" >
    <mkdir dir="${build.jtablet}"/>
    <javac 
		srcdir="${src}"          
		includes="**"
		destdir="${build.jtablet}" 
		source="1.5" 
		target="1.5"
		debug="on"
		classpathref="jtablet.classpath"/>
  </target>
	
  <target name="jtablet.jar" depends="svn.version,jtablet.compile" description="generate the initial jtablet jar" >
    <mkdir dir="${dist}/lib"/>
    <jar 
		jarfile="${dist}/lib/jtablet2-${svn.version}.original.jar"
		includes="cello/**"
    	excludes="cello/jtablet/impl/jpen/**"
    	level="9"
		basedir="${build.jtablet}">
        <manifest>
          	<attribute name="Built-By" value="Marcello"/>
        	<attribute name="Extension-Name" 			value="${ext.name}"/>
            <attribute name="Specification-Title" 		value="${spec.title}"/>
        	<attribute name="Specification-Vendor" 		value="${spec.vendor}"/>
    		<attribute name="Specification-Version" 	value="${spec.version}"/>
			<attribute name="Implementation-Title" 		value="${impl.title}"/>
    		<attribute name="Implementation-Vendor" 	value="${impl.vendor}"/>
        	<attribute name="Implementation-Vendor-Id" 	value="${impl.vendor.id}"/>
    		<attribute name="Implementation-Version" 	value="${impl.version}"/>
        	<section name="cello/jtablet/impl/">
        		<attribute name="Sealed" value="true"/>
        	</section>
        </manifest>
	</jar>
    <jar 
		jarfile="${dist}/lib/jtablet2-jpen-${svn.version}.original.jar"
		includes="cello/jtablet/impl/jpen/**"
    	level="9"
		basedir="${build.jtablet}">
        <manifest>
          	<attribute name="Built-By" value="Marcello"/>
        	<attribute name="Extension-Name" 			value="${ext.name}"/>
            <attribute name="Specification-Title" 		value="${spec.title}"/>
        	<attribute name="Specification-Vendor" 		value="${spec.vendor}"/>
    		<attribute name="Specification-Version" 	value="${spec.version}"/>
			<attribute name="Implementation-Title" 		value="${impl.title}"/>
    		<attribute name="Implementation-Vendor" 	value="${impl.vendor}"/>
        	<attribute name="Implementation-Vendor-Id" 	value="${impl.vendor.id}"/>
    		<attribute name="Implementation-Version" 	value="${impl.version}"/>
        	<section name="cello/jtablet/impl/jpen">
        		<attribute name="Sealed" value="true"/>
        	</section>
        </manifest>
	</jar>
  </target>
	
	<target name="jtablet.install" depends="jtablet.jar,jpen.jar">
		<mkdir dir="${user.home}/.jtablet"/>
		<copy 
			file="${dist}/lib/jtablet2-jpen-${svn.version}.original.jar" 
			tofile="${user.home}/.jtablet/jtablet-jpen.jar"/>
		<copy 
			file="${dist}/lib/jpen2-${svn.version}.original.jar" 
			tofile="${user.home}/.jtablet/jpen.jar"/>
		
	</target>
	
	<target name="jtablet.install.mac" depends="jtablet.jar,jtablet.install">
		<mkdir dir="${user.home}/Library/Java/Extensions"/>
		<copy 
			file="${dist}/lib/jtablet2-${svn.version}.original.jar" 
			tofile="${user.home}/Library/Java/Extensions/jtablet.jar"/>
	</target>

	
  <!-- demo package -->
  <path id="demo.classpath">
        <!-- <fileset dir="lib" includes="**/*.jar"/> -->
		<pathelement location="${build.jtablet}"/>
  </path>
  <target name="demo.compile" depends="init,jtablet.compile" description="compile the source" >
    <mkdir dir="${build.demo}"/>
	<javac 
		srcdir="${src.demo}"          
		includes="**"
		destdir="${build.demo}" 
		source="1.5" 
		target="1.5"
		debug="on"
		classpathref="demo.classpath"/>
  </target>	

  <target name="demo.jar" depends="demo.compile">
    <jar 
		jarfile="${dist}/lib/jtablet2-demo-${svn.version}.original.jar"
		includes="cello/**"
    	level="9"
    	basedir="${build.demo}">
        <manifest>
    	  <attribute name="Main-Class" value="cello.demo.jtablet.DemoApplet" />
          <attribute name="Built-By" value="Marcello"/>
          <attribute name="Sealed" value="true"/>
        </manifest>
	</jar>
  </target>
  <target name="demo.run" depends="demo.jar">
    <java           
    	fork="true"
  		jar="${dist}/lib/jtablet2-demo-${svn.version}.original.jar"/>
  </target>
	
	
  <!-- INSTALLER -->
  <path id="classpath.installer">
        <fileset dir="lib" includes="**/*.jar"/>
  </path>
  <target name="installer.compile" depends="init" description="compile the source" >
    <mkdir dir="${build.installer}"/>
    <javac 
		srcdir="${src.installer}"          
		includes="**"
		destdir="${build.installer}" 
		source="1.5" 
		target="1.5"
		debug="on"
		classpathref="classpath.installer"/>
  </target>

  <target name="installer.jar" depends="installer.compile">
    <jar 
		jarfile="${dist}/lib/jtablet2-installer-${svn.version}.original.jar"
		includes="cello/jtablet/installer**"
    	level="9"
    	basedir="${build.installer}">
	</jar>
  </target>
	
	
  <target name="jars" depends="jpen.jar,jtablet.jar,demo.jar,installer.jar" >
  </target>
	
	
  <target name="genkey">
    <genkey 
    	alias="jtablet2" 
    	storepass="notsecureatall5936510" 
		keypass="notsecureatall5936510"
    	validity="365">
      <dname>
        <param name="CN" value="JTablet Installer"/>
        <param name="O"  value="Cellosoft"/>
        <param name="C"  value="US"/>
      </dname>
    </genkey>
  </target>

	

	  <target name="exttest" depends="demo.compile">
	    <jar 
			jarfile="${dist}/lib/exttest-applet.jar"
			includes="cello/demo/jtablet/ext/TestApplet.class"
	    	level="9"
	    	basedir="${build.demo}">
	        <manifest>
	          <attribute name="Built-By" value="Marcello"/>
	        </manifest>
		</jar>
	    <jar 
			jarfile="${dist}/lib/exttest-other.jar"
			includes="cello/demo/jtablet/ext/OtherClass.class"
	    	level="9"
	    	basedir="${build.demo}">
	        <manifest>
	          <attribute name="Built-By" value="Marcello"/>
	        </manifest>
		</jar>
	    <jar 
			jarfile="${dist}/lib/exttest-ext.jar"
			includes="cello/demo/jtablet/ext/ExtClass.class"
	    	level="9"
	    	basedir="${build.demo}">
	        <manifest>
	          <attribute name="Built-By" value="Marcello"/>
	        	<attribute name="Extension-Name" value="exttest"/>
	        	<attribute name="Specification-Vendor" value="exttest"/>
	        	<attribute name="Specification-Version" value="1.0"/>
	        	<attribute name="Implementation-Vendor-Id" value="exttest"/>
	        	<attribute name="Implementation-Vendor" value="exttest"/>
	        	<attribute name="Implementation-Version" value="1.0"/>

	        </manifest>
		</jar>
	    <jar 
			jarfile="${dist}/lib/exttest-unused.jar"
			includes="cello/demo/jtablet/ext/ExtLoadingClass.class"
	    	level="9"
	    	basedir="${build.demo}">
	        <manifest>
	          <attribute name="Built-By" value="Marcello"/>

	        	<attribute name="Extension-List" value="exttest"/>
	        	<attribute name="exttest-Extension-Name" value="exttest"/>
	        	<attribute name="exttest-Specification-Version" value="1.0"/>
	        	<attribute name="exttest-Specification-Vendor" value="Cellosoft"/>
	        	<attribute name="exttest-Implementation-Version" value="1.0"/>
	        	<attribute name="exttest-Implementation-Vendor-Id" value="cello"/>
	        	<attribute name="exttest-Implementation-URL" value="http://sketchstudio.cellosoft.com/jtablet2/ext/exttest-ext.signed.jar"/>
	        	
	        </manifest>
		</jar>
	  	<signjar 
			alias="jtablet2" 
			storepass="notsecureatall5936510"
			keypass="notsecureatall5936510"
	  		lazy="true"
	  		jar="${dist}/lib/exttest-ext.jar"
	  		signedjar="${dist}/lib/exttest-ext.signed.jar">
		</signjar>
	  </target>
	

  <target name="jpen.signed" depends="jpen.jar">
  	<signjar 
		alias="jtablet2" 
		storepass="notsecureatall5936510"
		keypass="notsecureatall5936510"
  		lazy="true"
  		jar="${dist}/lib/jpen2-${svn.version}.original.jar"
  		signedjar="${dist}/jpen2-${svn.version}.jar">
	</signjar>
  </target>

  <target name="jtablet.signed" depends="jtablet.jar">
  	<signjar 
		alias="jtablet2" 
		storepass="notsecureatall5936510"
		keypass="notsecureatall5936510"
  		lazy="true"
  		jar="${dist}/lib/jtablet2-${svn.version}.original.jar"
  		signedjar="${dist}/jtablet2-${svn.version}.jar">
	</signjar>
  </target>
 
  <target name="demo.signed" depends="demo.jar">
  	<signjar 
		alias="jtablet2" 
		storepass="notsecureatall5936510"
		keypass="notsecureatall5936510"
  		lazy="true"
  		jar="${dist}/lib/jtablet2-demo-${svn.version}.original.jar"
  		signedjar="${dist}/jtablet2-demo-${svn.version}.jar">
	</signjar>
  </target>
  
  <target name="installer.signed" depends="installer.jar">
  	<signjar 

		alias="jtablet2" 
		storepass="notsecureatall5936510"
		keypass="notsecureatall5936510"
  		lazy="true"
  		jar="${dist}/lib/jtablet2-installer-${svn.version}.original.jar"
  		signedjar="${dist}/jtablet2-installer-${svn.version}.jar">
	</signjar>
  </target>
	
	<!--
  <target name="installer-dist" depends="signedjars">
    <mkdir dir="${dist}/installer"/>

	<filter token="buildVersion" value="${svn.version}"/>
	<copy todir="${dist}/installer" filtering="true">
		<fileset dir="html">
		  <include name="**/*"/>
		</fileset>
	</copy>
	<copy file="${dist}/signed/jtablet-installer${svn.version}.original.jar" tofile="${dist}/installer/jtablet-installer${svn.version}.jar" />
	<copy todir="${dist}/installer" file="lib/javascript.jar" />
  </target>
-->
  <target name="jars.signed" depends="jpen.signed,jtablet.signed,demo.signed,installer.signed">
  </target>
  
  <target name="javadocs" depends="jpen.compile">  
  	<mkdir dir="${docs.api}"/>
	<javadoc
        destdir="${docs.api}"
        author="true"
        version="true"
        use="true"
		classpathref="jtablet.classpath"
		Overview="src/overview.html"
        windowtitle="JTablet 2.0 API"
		Header="JTablet 2.0 API">

		 <packageset dir="${src}" defaultexcludes="yes">
		   <include name="cello/jtablet/**"/>
		   <exclude name="cello/jtablet/impl/**"/>
		 </packageset>
		 <link href="http://java.sun.com/j2se/1.5.0/docs/api/" packagelistloc="java1.5-package-list"/>
		</javadoc>
  </target>
	
  <target name="jars.demo" depends="jpen.compile,jtablet.compile,demo.compile">

    <jar 
		jarfile="html/demos/jpen2-ext.jar"
		includes="jpen/**"
    	level="9"
    	basedir="${build.jpen}">
        <manifest>
          <attribute name="Built-By" value="Marcello"/>
          <attribute name="Sealed" value="true"/>


        	<attribute name="Extension-Name" value="jpen2"/>
        	<attribute name="Specification-Vendor" value="jpen"/>
        	<attribute name="Specification-Version" value="2.0"/>
        	<attribute name="Implementation-Vendor-Id" value="jpen"/>
        	<attribute name="Implementation-Vendor" value="jpen"/>
        	<attribute name="Implementation-Version" value="1.1.3"/>

        </manifest>
	</jar>
    <jar 
		jarfile="html/demos/jtablet2-ext.jar"
		includes="cello/**"
    	level="9"
    	basedir="${build.jtablet}">
        <manifest>
          <attribute name="Built-By" value="Marcello"/>
          <attribute name="Sealed" value="true"/>


        	<attribute name="Extension-Name" value="cello.jtablet2"/>
        	<attribute name="Specification-Vendor" value="Cellosoft"/>
        	<attribute name="Specification-Version" value="2.0"/>
        	<attribute name="Implementation-Vendor-Id" value="cello"/>
        	<attribute name="Implementation-Vendor" value="Cellosoft"/>
        	<attribute name="Implementation-Version" value="2.0"/>

        </manifest>
	</jar>
    <jar 
		jarfile="html/demos/jtablet2-demo.jar"
		includes="cello/**"
    	level="9"
    	basedir="${build.demo}">
        <manifest>
    	  <attribute name="Main-Class" value="cello.demo.jtablet.DemoApplet.class" />
          <attribute name="Built-By" value="JTablet 2.0 build script"/>
        </manifest>
	</jar>
    <jar 
		jarfile="html/demos/jtablet2-demo-ext.jar"
		includes="cello/**"
    	level="9"
    	basedir="${build.demo}">
        <manifest>
    	  <attribute name="Main-Class" value="cello.demo.jtablet.DemoApplet.class" />
          <attribute name="Built-By" value="JTablet 2.0 build script"/>

        	<attribute name="Extension-List" value="jtablet2 jpen2"/>
        	<attribute name="jtablet2-Extension-Name" value="cello.jtablet2"/>
        	<attribute name="jtablet2-Specification-Version" value="1.9"/>
        	<attribute name="jtablet2-Specification-Vendor" value="Cellosoft"/>
        	<attribute name="jtablet2-Implementation-Version" value="1.9"/>
        	<attribute name="jtablet2-Implementation-Vendor-Id" value="cello"/>
        	<attribute name="jtablet2-Implementation-URL" value="http://sketchstudio.cellosoft.com/jtablet2/ext/jtablet2-ext.signed.jar"/>
        	
        	<attribute name="jpen2-Extension-Name" value="jpen"/>
        	<attribute name="jpen2-Specification-Version" value="2.0"/>
        	<attribute name="jpen2-Specification-Vendor" value="jpen"/>
        	<attribute name="jpen2-Implementation-Version" value="2.0"/>
        	<attribute name="jpen2-Implementation-Vendor-Id" value="jpen"/>
        	<attribute name="jpen2-Implementation-URL" value="http://sketchstudio.cellosoft.com/jtablet2/ext/jpen2-ext.signed.jar"/>
        </manifest>
	</jar>


  </target>
	  <target name="jars.demo.signed" depends="jars.demo">
	  	<signjar 
			alias="jtablet2" 
			storepass="notsecureatall5936510"
			keypass="notsecureatall5936510"
	  		lazy="true"
	  		jar="html/demos/jtablet2-ext.jar"
	  		signedjar="html/demos/jtablet2-ext.signed.jar">
		</signjar>
	  	<signjar 
			alias="jtablet2" 
			storepass="notsecureatall5936510"
			keypass="notsecureatall5936510"
	  		lazy="true"
	  		jar="html/demos/jpen2-ext.jar"
	  		signedjar="html/demos/jpen2-ext.signed.jar">
		</signjar>
	  </target>
	
  
  <target name="clean" description="clean up" >
    <!-- Delete the ${build.jtablet} and ${dist} directory trees -->
    <delete dir="${build.jtablet}"/>

    <delete dir="${build.jpen}"/>
    <delete dir="${build.demo}"/>
    <delete dir="${build.installer}"/>
  	<!--
    <delete dir="${dist}/installer"/>
  	<delete file="${dist}/lib/jtablet2-${svn.version}.original.jar"/>
    <delete file="${dist}/jtablet2.jar"/>
    -->
  </target>
</project>
